---
description: Privilege Escalation Enumeration (Windows)
---

# Enumeration

### Auto-Enumeration

Since manually checking everything can be very time-consuming we can use various scripts to automate the process. Here is a list of useful scripts:

#### [Windows-privesc-check](https://github.com/pentestmonkey/windows-privesc-check)

```powershell
PS> .\windows-privesc-check2.exe --audit -a -o wpc-report
```

#### [WinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS)

One of the most powerful tool that not only actively hunts for privilege escalation misconfigurations, but highlights them for the user in the result.

<pre class="language-powershell"><code class="lang-powershell"><strong>#Before running WinPeas add the following registry key (to output the color):
</strong>reg add HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1
PS> .\winpeas.exe</code></pre>

#### [PowerSploit - PowerUp.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1)

```powershell
PS> powershell.exe -nop -exec bypass
PS> Import-Module .\PowerUp.ps1
PS> Invoke-AllChecks | Out-File -Encoding ASCII checks.txt
```

#### [Sherlock.ps1](https://github.com/rasta-mouse/Sherlock/blob/master/Sherlock.ps1)

```powershell
#Locate Sherlock.ps1 and add the following line at the end:
Find-AllVulns
```

#### [JAWS](https://github.com/411Hall/JAWS)

{% code overflow="wrap" %}
```powershell
PS> powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt
```
{% endcode %}

### User Enumeration

Who we are? What permissions we have?&#x20;

{% code overflow="wrap" %}
```powershell
whoami
whoami/priv
#SetImpersonatePrivilege=Enabled or SeAssignPrimaryTokenPrivilege=Enabled result in JuicyPotato or Rotten Potato attack vector.
```
{% endcode %}

In which groups we are?

{% code overflow="wrap" %}
```powershell
net user $USERNAME
```
{% endcode %}

Are there more users on the machine?

```
net user
```

### OS Version and Architecture

Does the name of the host reveals some functional roles (SRV, DB,WEB...) or any pattern client(n), client(n+1).. that could help discover additional machines?

```bash
hostname
```

How old is the kernel/OS? May we find some exploits?

```bash
systeminfo #Review OS Version, architecture and Hotfixes.
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" C:"System Type"
```

### Running Processes and Services

Is there any process or service that might allow us to elevate privileges? Unquoted service paths?

{% code overflow="wrap" %}
```bash
#/SVC: specific Windows Services
tasklist /SVC
#Output doesn't list processes run by privileged users, we need higher privileges to gather this information.

#Using wmic:
wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows"

wmic service get name,pathname,displayname,startmode | findstr /i auto | findstr /i /v "C:\Windows\\" | findstr /i /v """
```
{% endcode %}

**Note:** Process must run as privileged user.

### Networking information

Do we have access to other networks (to pivot)? If true, how do we route the traffic?

```
ipconfig /all
route print
```

Which ports are open? Is any of those ports only available through the loopback address?

{% code overflow="wrap" %}
```bash
#View active network connections:
netstat -ano
#Output can contain ESTABLISHED connections, which can indicate that other users are connected to this machine and we can try to target later.

netstat -anpb TCP
```
{% endcode %}

### Firewall status and Rules

Is there any service running on the machine blocked by the firewall and only accessible by the loopback address? Can we gather information about inbound/outbound filtering (to facilitate port forwarding and tunneling while pivoting)?

{% code overflow="wrap" %}
```bash
#Inspect firewall profile:
netsh advfirewall show currentprofile

#If the firewall is active we can have a look at the rules:
netsh advfirewall firewall show rule name=all
```
{% endcode %}

### Scheduled Tasks

Are there any scheduled task on the machine? Does it contain any misconfigured permission?

```bash
schtasks /query /fo LIST /v
#/query: Displays tasks
#/fo LIST: output format to simple list
#/v: Verbose
```

### Installed Applications and patch levels

Which applications are installed on the system? Are these outdated and vulnerable?

```bash
#List applications installed by the Windows Installer:
wmic product get name, version, vendor
```

Does the system miss any important security update? How long since last update?

```bash
#List system-wide updates (KBXXXXXX):
wmic qfe get Caption, Description, HotFixID, InstalledOn

# Common folders:
C:\Program Files\ #for interesting installed programs
C:\Program Files(x86)\ #for interesting installed programs
```

### R/W Files and Directories

Is there any world readable file/directory where we can obtain information? Is there any world writable file/directory that we can modify (executed under the context of a privileged user)?

{% code overflow="wrap" %}
```bash
#Change $PATH
#Using accesschk:
accesschk.exe -uws "Everyone" "$PATH"

#Using Powershell:
PS> Get-ChildItem "$PATH" -R ecurse | Get-ACL | ?{$_.AccessToString -match "Everyone\sAllow\s\sModify"}
```
{% endcode %}

### Unmounted Filesystems

Are there any unmounted disk? If we find one, mount it and enumerate for interesting information:

```bash
#List mounted and unmounted drives:
mountvol

#Mount the volume:
mountvol D:\ \\$ID
```

### Device Drivers

Are there any device driver vulnerable on the system that we can exploit?

{% code overflow="wrap" %}
```bash
#Display list of loaded drivers:
PS> driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object ‘Display Name’, ‘Start Mode’, Path

#Get drivers & their version:
PS> Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer

#Driver version of an specific driver searched by $NAME:
Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*$NAME*"}

```
{% endcode %}

### Binaries that AutoElevate

Can we run Windows Installer Packages with elevated privileges?

```bash
reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer
```

If this setting is enabled (0x1), we could craft an MSI file and run it to elevate our privileges.
