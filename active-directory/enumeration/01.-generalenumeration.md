---
description: AD Enumeration
---

# General enumeration

> Once we have a foothold on a domain joined machine, we usually want to start gathering info about the domain itself, users, groups, trusts, GPOs, ACLs, shares...

#### Tools

* [**PowerView**](https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1): Writen for red-teamers. Need to bypass AMSI if detected. Load with ". .\PowerView.ps1"
* **Active Directory PowerShell Module**: Signed by Microsoft. Load with "Import-Module .\Mic....dll" + "Import-Module .\ActiveDirectory\ActiveDirectory.psd1"

### Get Current Domain

```bash
#PowerView:
Get-NetDomain

#AD Module:
Get-ADDomain
```

### Get object of another domain (where we have trusts like parent-child or permissions)

```bash
#PowerView:
Get-NetDomain -Domain $DOMAIN

#AD Module:
Get-ADDomain -Identity $DOMAIN
```

### Extract domain SID (Useful for later attacks)

```bash
#PowerView:
Get-DomainSID
Get-DomainSID -Domain $DOMAIN

#AD Module:
(Get-ADDomain).DomainSID
```

### Get current policy

```bash
#PowerView:
Get-DomainPolicy #Get list of all policies
(Get-DomainPolicy)."system access" #Query the specific policy (from the previous command)
(Get-DomainPolicy)."kerberos policy" #Interesting when creating tickets, anti-malware can detect forged tickets if they do not follow this policy.
```

### Get domain controllers

```bash
#PowerView:
Get-NetDomainController
Get-NetDomainController -Domain $DOMAIN

#AD Module:
Get-ADDomainController
Get-ADDomainController -DomainName $DOMAIN -Discover
```

### Get password policy (locks, expiration..)

```bash
#cmd:
net accounts /domain
```

### Get trusted domains

```bash
#cmd:
nltest.exe /Trusted_Domains
```
